#!/bin/bash
set -euo pipefail

BASE_DIR="$HOME/Screen_Switcher"
APP_DIR="$BASE_DIR/app"

echo "Installing Screen_Switcher to $APP_DIR..."

mkdir -p "$APP_DIR"
cd "$APP_DIR" || exit 1

# Create/activate venv
python3 -m venv .venv
# shellcheck source=/dev/null
source .venv/bin/activate

pip install --upgrade pip
pip install pyobjc pynput

MAIN_URL="https://raw.githubusercontent.com/youraverageazurecosplay-png/Screen_Switcher/main/Screen_Switcher.py"
curl -fsL "$MAIN_URL" -o Screen_Switcher.py

cd "$BASE_DIR" || exit 1

cat > update.sh << 'EOF'
#!/bin/bash
set -euo pipefail
APP_DIR="$(dirname "$0")/app"
cd "$APP_DIR"
source .venv/bin/activate
pip install --upgrade pip pyobjc pynput
curl -fsL "https://raw.githubusercontent.com/youraverageazurecosplay-png/Screen_Switcher/main/Screen_Switcher.py" -o Screen_Switcher.py
echo "Updated!"
EOF

chmod +x update.sh

cat > Run_Screen_Switcher.command << 'EOF'
#!/bin/bash
APP_DIR="$(dirname "$0")/app"
cd "$APP_DIR"
source .venv/bin/activate
python Screen_Switcher.py
EOF

chmod +x Run_Screen_Switcher.command

echo "Done! Double-click $BASE_DIR/Run_Screen_Switcher.command"
echo "To update later: cd $BASE_DIR && ./update.sh"
